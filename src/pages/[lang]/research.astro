---
import BaseLayout from '@layouts/BaseLayout.astro';
import { useTranslations, type Lang } from '@i18n/ui';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  return [
    { params: { lang: 'en' } },
    { params: { lang: 'zh' } },
  ];
}

const { lang } = Astro.params as { lang: Lang };
const t = useTranslations(lang);

let researchItems: any[] = [];
try {
  researchItems = await getCollection('research', ({ data }) => {
    return data.lang === lang;
  });
} catch (e) {
  // Collection might not exist yet
}

const title = lang === 'en' ? 'Research - Research Lab' : '研究方向 - 研究实验室';
const description = lang === 'en' 
  ? 'Research areas and projects'
  : '研究方向和项目';
---

<BaseLayout lang={lang} title={title} description={description} currentPath={`/${lang}/research/`}>
  <div class="container">
    <h1 class="section-title">{t('research.title')}</h1>
    
    {researchItems.length === 0 ? (
      <div class="research-details">
        <article id="research-area-1" class="research-detail-card" data-area="1">
          <h2>{lang === 'en' ? 'Research Area 1' : '研究方向一'}</h2>
          <div class="research-content">
            <h3>{lang === 'en' ? 'Overview' : '概述'}</h3>
            <p>{lang === 'en' 
              ? 'This is where you can provide a comprehensive overview of your first research area. Describe the main focus, goals, and significance of this research direction.'
              : '这里可以全面介绍你的第一个研究方向。描述主要关注点、目标和这个研究方向的重要性。'}
            </p>
            
            <h3>{lang === 'en' ? 'Methodology' : '研究方法'}</h3>
            <p>{lang === 'en' 
              ? 'Explain the methodologies and approaches used in this research area. Describe the tools, techniques, and frameworks employed.'
              : '解释这个研究方向使用的方法和途径。描述使用的工具、技术和框架。'}
            </p>
            
            <h3>{lang === 'en' ? 'Key Contributions' : '主要贡献'}</h3>
            <ul>
              <li>{lang === 'en' ? 'Contribution 1: Description of your first key contribution' : '贡献一：你的第一个主要贡献的描述'}</li>
              <li>{lang === 'en' ? 'Contribution 2: Description of your second key contribution' : '贡献二：你的第二个主要贡献的描述'}</li>
              <li>{lang === 'en' ? 'Contribution 3: Description of your third key contribution' : '贡献三：你的第三个主要贡献的描述'}</li>
            </ul>
            
            <h3>{lang === 'en' ? 'Future Directions' : '未来方向'}</h3>
            <p>{lang === 'en' 
              ? 'Share your vision for the future of this research area. What are the next steps and potential developments?'
              : '分享你对这个研究方向未来的愿景。下一步是什么？有哪些潜在的发展？'}
            </p>
          </div>
        </article>
        
        <article id="research-area-2" class="research-detail-card" data-area="2">
          <h2>{lang === 'en' ? 'Research Area 2' : '研究方向二'}</h2>
          <div class="research-content">
            <h3>{lang === 'en' ? 'Overview' : '概述'}</h3>
            <p>{lang === 'en' 
              ? 'This is where you can provide a comprehensive overview of your second research area. Describe the main focus, goals, and significance of this research direction.'
              : '这里可以全面介绍你的第二个研究方向。描述主要关注点、目标和这个研究方向的重要性。'}
            </p>
            
            <h3>{lang === 'en' ? 'Methodology' : '研究方法'}</h3>
            <p>{lang === 'en' 
              ? 'Explain the methodologies and approaches used in this research area. Describe the tools, techniques, and frameworks employed.'
              : '解释这个研究方向使用的方法和途径。描述使用的工具、技术和框架。'}
            </p>
            
            <h3>{lang === 'en' ? 'Key Contributions' : '主要贡献'}</h3>
            <ul>
              <li>{lang === 'en' ? 'Contribution 1: Description of your first key contribution' : '贡献一：你的第一个主要贡献的描述'}</li>
              <li>{lang === 'en' ? 'Contribution 2: Description of your second key contribution' : '贡献二：你的第二个主要贡献的描述'}</li>
              <li>{lang === 'en' ? 'Contribution 3: Description of your third key contribution' : '贡献三：你的第三个主要贡献的描述'}</li>
            </ul>
            
            <h3>{lang === 'en' ? 'Future Directions' : '未来方向'}</h3>
            <p>{lang === 'en' 
              ? 'Share your vision for the future of this research area. What are the next steps and potential developments?'
              : '分享你对这个研究方向未来的愿景。下一步是什么？有哪些潜在的发展？'}
            </p>
          </div>
        </article>
        
        <article id="research-area-3" class="research-detail-card" data-area="3">
          <h2>{lang === 'en' ? 'Research Area 3' : '研究方向三'}</h2>
          <div class="research-content">
            <h3>{lang === 'en' ? 'Overview' : '概述'}</h3>
            <p>{lang === 'en' 
              ? 'This is where you can provide a comprehensive overview of your third research area. Describe the main focus, goals, and significance of this research direction.'
              : '这里可以全面介绍你的第三个研究方向。描述主要关注点、目标和这个研究方向的重要性。'}
            </p>
            
            <h3>{lang === 'en' ? 'Methodology' : '研究方法'}</h3>
            <p>{lang === 'en' 
              ? 'Explain the methodologies and approaches used in this research area. Describe the tools, techniques, and frameworks employed.'
              : '解释这个研究方向使用的方法和途径。描述使用的工具、技术和框架。'}
            </p>
            
            <h3>{lang === 'en' ? 'Key Contributions' : '主要贡献'}</h3>
            <ul>
              <li>{lang === 'en' ? 'Contribution 1: Description of your first key contribution' : '贡献一：你的第一个主要贡献的描述'}</li>
              <li>{lang === 'en' ? 'Contribution 2: Description of your second key contribution' : '贡献二：你的第二个主要贡献的描述'}</li>
              <li>{lang === 'en' ? 'Contribution 3: Description of your third key contribution' : '贡献三：你的第三个主要贡献的描述'}</li>
            </ul>
            
            <h3>{lang === 'en' ? 'Future Directions' : '未来方向'}</h3>
            <p>{lang === 'en' 
              ? 'Share your vision for the future of this research area. What are the next steps and potential developments?'
              : '分享你对这个研究方向未来的愿景。下一步是什么？有哪些潜在的发展？'}
            </p>
          </div>
        </article>
      </div>
    ) : (
      <div class="research-details">
        {researchItems.map((item) => (
          <article id={item.slug} class="research-detail-card">
            <h2>{item.data.title}</h2>
            {item.data.description && <p class="research-lead">{item.data.description}</p>}
            {item.data.image && (
              <img src={item.data.image} alt={item.data.title} class="research-image" />
            )}
            <div class="research-markdown">
              {item.render().Content && <item.render().Content />}
            </div>
            {item.data.tags && item.data.tags.length > 0 && (
              <div class="tags">
                {item.data.tags.map((tag: string) => (
                  <span class="tag">{tag}</span>
                ))}
              </div>
            )}
          </article>
        ))}
      </div>
    )}
  </div>
</BaseLayout>

<style>
  .research-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 6px;
    margin-bottom: 1rem;
  }
  
  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
  }
  
  .tag {
    padding: 0.25rem 0.75rem;
    background-color: var(--color-bg-secondary);
    border-radius: 4px;
    font-size: 0.875rem;
    color: var(--color-text-secondary);
  }
  
  .research-details {
    display: flex;
    flex-direction: column;
    gap: 3.5rem;
  }
  
  .research-detail-card {
    scroll-margin-top: 2rem;
  }
  
  .research-detail-card h2 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 2rem;
    color: var(--color-accent);
    border-bottom: 3px solid var(--color-accent);
    padding-bottom: 0.5rem;
  }
  
  .research-content {
    max-width: 900px;
  }

  .research-lead {
    max-width: 900px;
    color: var(--color-text-secondary);
    line-height: 1.8;
    margin: 0.75rem 0 1.5rem;
  }

  .research-markdown {
    max-width: 900px;
  }
  
  .research-content h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-top: 2rem;
    margin-bottom: 1rem;
    color: var(--color-text);
  }
  
  .research-content p {
    line-height: 1.8;
    margin-bottom: 1.5rem;
    color: var(--color-text-secondary);
  }
  
  .research-content ul {
    margin-left: 2rem;
    margin-bottom: 1.5rem;
    line-height: 1.8;
  }
  
  .research-content li {
    margin-bottom: 0.75rem;
    color: var(--color-text-secondary);
  }
  
  @media (max-width: 768px) {
    .research-detail-card h2 {
      font-size: 1.5rem;
    }
    
    .research-content h3 {
      font-size: 1.25rem;
    }
  }
</style>

<script>
  // 仅做定位：如果 URL 带 hash（从首页卡片点进来），平滑滚动到对应研究方向
  function scrollToHash() {
    const hash = window.location.hash;
    if (!hash) return;
    const targetId = hash.substring(1);
    const targetElement = document.getElementById(targetId);
    if (!targetElement) return;
    setTimeout(() => {
      targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 50);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', scrollToHash);
  } else {
    scrollToHash();
  }
  window.addEventListener('hashchange', scrollToHash);
</script>

